## Практическая работа 11

### Анализ системы и шаги для обеспечения безопасности пользовательских данных 

1. приоритет высокий (реализация в течение 1-2 дней)

- Немедленная приостановка доступа к деталям заказа по уникальному номеру (временная мера): самый быстрый способ предотвратить дальнейшие утечки. Сообщение на странице, куда раньше вводился номер заказа, объясняет, что из-за проблем с безопасностью доступ временно ограничен (Извините за временные неудобства). Клиентам предлагается связаться с поддержкой для получения информации о заказе. 

**Обоснование**: Это временное решение предотвратит дальнейшие утечки, пока не будет найдено и устранено основное слабое место.

- Аудит логов: Необходимо срочно проанализировать логи всех сервисов, особенно "Пользователи", "Заказы", "Каталог товаров".  Нужно искать необычную активность, массовые запросы к данным, подозрительные IP-адреса, попытки несанкционированного доступа. Обоснование:  Поможет понять, как произошла утечка, какие именно данные были скомпрометированы и, возможно, даже идентифицировать злоумышленника.

- Оповещение для клиентов: Нужно признать факт утечки данных.  Объяснить, что предприняты меры по расследованию инцидента и усилению безопасности.  Предупредить клиентов о возможных фишинговых атаках и рекомендовать им быть бдительными и не предоставлять личную информацию по телефону или электронной почте.  Предложить сменить пароли. Обоснование:  Открытость и честность с клиентами поможет сохранить доверие.  Предупреждение о фишинге поможет снизить ущерб от атак.

2. приоритет высокий (реализация в течение 1-2 недель)

- Усиление аутентификации: Полностью отказаться от доступа к деталям заказа по уникальному номеру. Внедрить полноценную систему аутентификации (логин/пароль) для просмотра деталей заказа.  Можно рассмотреть двухфакторную аутентификацию (2FA) для повышения безопасности. 

**Обоснование**:  Это устранит основную уязвимость, связанную с неавторизованным доступом к данным заказа.

- Анализ кода на предмет уязвимостей: Провести комплексный анализ кода всех сервисов на предмет уязвимостей, особенно тех, которые перечислены в OWASP TOP 10. Использовать статические анализаторы кода (SAST) и динамические анализаторы кода (DAST).  Особое внимание уделить сервисам "Пользователи", "Заказы" и "Каталог товаров". Обоснование:  Поможет выявить и устранить уязвимости, которые могли быть использованы для утечки данных.

- Обновление зависимостей: Убедиться, что все используемые библиотеки и фреймворки обновлены до последних версий с исправленными уязвимостями. Обоснование:  Устаревшие зависимости часто содержат известные уязвимости, которые легко эксплуатировать.

- Пересмотр системы логирования и мониторинга: Убедиться, что логи содержат достаточно информации для анализа инцидентов, но не содержат конфиденциальную информацию (например, пароли). Настроить мониторинг на обнаружение подозрительной активности. 

**Обоснование:** Логирование и мониторинг помогают выявлять и расследовать инциденты безопасности.

### Защита от конкретных векторов атак (приоритет высокий, реализация в течение 1-2 недель):

- Injections (инъекции)

**Решение**: Использовать параметризованные запросы (prepared statements) или ORM для доступа к базе данных.  Избегать конкатенации строк для формирования SQL-запросов.  Экранировать данные, полученные от пользователя, перед их использованием в запросах к базе данных.  Использовать валидацию на стороне сервера для проверки вводимых данных.
Конкретно для вашего случая: Проверить все места, где используется уникальный номер заказа в запросах к базе данных. Убедиться, что он правильно экранируется и валидируется.

- Broken Authentication (нарушенная аутентификация)

**Решение**: Внедрить надежную систему аутентификации с использованием сильных паролей (минимальная длина, сложность). Использовать многофакторную аутентификацию (MFA).  Реализовать механизм блокировки аккаунта после нескольких неудачных попыток входа.  Защитить сессии пользователей (например, с помощью HTTPOnly cookies и CSRF-токенов).
Конкретно для вашего случая:  Внедрить полноценную аутентификацию для доступа к деталям заказа, как описано выше.  Оценить надежность текущей системы хранения паролей (используются ли современные алгоритмы хеширования, такие как bcrypt или Argon2).

- Sensitive Data Exposure (незащищённость конфиденциальных данных)

**Решение**: Шифровать конфиденциальные данные как при передаче (TLS/SSL), так и при хранении (encryption at rest).  Избегать хранения конфиденциальной информации в логах.  Ограничить доступ к конфиденциальным данным только авторизованным пользователям.  Использовать маскирование данных в интерфейсах.
Конкретно для вашего случая: Проверить, какие данные хранятся о клиентах (адреса, телефоны, номера кредитных карт).  Убедиться, что они надежно зашифрованы.  Пересмотреть систему логирования и удалить из логов все конфиденциальные данные.

- XML External Entities (XXE) & Insecure Deserialization (внешние сущности XML, небезопасная десериализация)

**Решение**: Отключить обработку внешних сущностей XML.  Избегать использования небезопасных методов десериализации.  Использовать безопасные форматы данных (например, JSON) вместо XML.
Конкретно для вашего случая:  Проверить, используются ли в вашей системе XML и десериализация объектов. Если да, то принять меры по защите от этих атак.  Это менее вероятно, но стоит проверить.

- Broken Access Control (нарушение контроля доступа)

**Решение**: Реализовать строгий контроль доступа ко всем ресурсам системы. Использовать принципы наименьших привилегий.  Проверять права доступа перед каждым запросом к данным.
Конкретно для вашего случая: Убедиться, что только авторизованный пользователь может получить доступ к деталям своего заказа.  Проверить, что администраторы системы не имеют доступа к конфиденциальной информации о клиентах без необходимости.  После внедрения аутентификации, тщательно протестировать права доступа для разных ролей пользователей.

**Дополнительные шаги (средний приоритет, реализация в течение месяца):**

- Регулярное тестирование на проникновение (Penetration Testing):  Привлекать внешних экспертов для проведения регулярного тестирования на проникновение.
- Обучение персонала: Обучать персонал основам безопасности и правилам обработки конфиденциальных данных.
- Внедрение системы управления уязвимостями (Vulnerability Management):  Использовать инструменты для автоматического сканирования на уязвимости и отслеживания их исправления.
- Bug Bounty Program:  Запустить программу вознаграждения за обнаружение уязвимостей.

### Система управления заказом:

- Полная аутентификация: Клиент должен зарегистрироваться (логин/пароль) или использовать существующую учетную запись (например, через OAuth).
- Доступ к заказам только после аутентификации: После входа в систему клиент видит список своих заказов.
- Безопасное отображение деталей заказа:  Детали заказа отображаются только после аутентификации и проверки, что заказ принадлежит текущему пользователю.
- Удаление уникального номера заказа из URL:  Вместо использования уникального номера в URL (например, /order/12345), использовать идентификатор заказа, который не виден пользователю.  Вместо этого, в URL может быть просто /order/{orderId}, где orderId - это внутренний идентификатор заказа, связанный с учетной записью пользователя.
- Использование протокола HTTPS:  Обязательно использовать HTTPS для всего сайта, чтобы защитить данные при передаче.

**Обоснование**

1. Скорость реагирования:  Быстрые действия по устранению уязвимости и предупреждению клиентов помогут минимизировать ущерб.
2. Устранение основной проблемы: Внедрение аутентификации и переработка системы управления заказами устранит основную уязвимость, которая привела к утечке данных.
3. Комплексный подход:  Защита от OWASP TOP 10 и других векторов атак обеспечит более надежную защиту от будущих атак.
4. Улучшение репутации:  Прозрачность и открытость в отношении инцидента, а также принятые меры по усилению безопасности помогут восстановить доверие клиентов.

|Описание API/системы|Возможные векторы атак|Способы защиты от векторов атак|
|-|-|-|
|Платежный шлюз (например, PayPal): Обработка платежей клиентов, передача данных кредитных карт|- Man-in-the-Middle (MitM) атаки (перехват данных) <br> - XSS-атаки (через обработку возвращаемых данных) <br> - CSRF-атаки (если интеграция использует GET-запросы для изменений) <br> - Атаки переполнения (DoS) <br> - Подмена данных|- HTTPS: Использовать только HTTPS для всех коммуникаций. - Валидация сертификатов:  Убедиться в валидности сертификатов платежного шлюза. - Валидация возвращаемых данных: Тщательно валидировать все данные, полученные от платежного шлюза. - Использование токенов CSRF: Для POST-запросов. - Rate Limiting: Ограничение количества запросов с одного IP-адреса. - Фильтрация входящих данных: Исключение инъекций кода|