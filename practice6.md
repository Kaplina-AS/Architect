## Практическая работа 6

### Выбор БД

**Сервис "Пользователи"** 

Хранение информации о пользователях (имя, email, пароль, адрес, история заказов, предпочтения, роли).  Аутентификация и авторизация пользователей.

**Тип базы данных:** Реляционная база данных (например, PostgreSQL, MySQL).

**Обоснование:**
- Структурированные данные: Информация о пользователях имеет четкую структуру.
- Безопасность: Важна безопасность данных, особенно паролей.
- Целостность данных: Важна целостность данных пользователей.
- Отношения: Необходимы отношения между пользователями, заказами, адресами, ролями.

Альтернативные варианты: Специализированные сервисы аутентификации (Auth0, Firebase Authentication):  Удобны для аутентификации, но могут потребовать дополнительную базу данных для хранения дополнительных данных о пользователях.

**Сервис "Управление производством**

Управление производственным процессом, хранение информации о материалах, станках, процессах, планах производства, статусах производства, контроле качества.

**Тип базы данных:** Реляционная база данных (например, PostgreSQL, MySQL).

**Обоснование:** 
- Структурированные данные. Большинство данных о производстве структурированы.
- Сложные отношения между материалами, процессами, станками, сотрудниками, планами производства.
- Транзакционная целостность. Важна для обеспечения согласованности данных о производстве.
- Сложные запросы: необходимы для планирования производства, отслеживания статуса производства, анализа эффективности.

Альтернативные варианты: Time-Series Database. Для хранения данных о работе станков, температурных режимах и других временных рядов.  Целесообразна для мониторинга и анализа работы оборудования.

**Сервис "Управление складом"** 

Хранение информации о наличии товара на складе (количество, расположение, состояние), материалах, компонентах. Отслеживание перемещений товара и материалов.

**Тип базы данных:** Реляционная база данных (например, PostgreSQL, MySQL).

**Обоснование:**
- Транзакционная целостность критична при изменении количества товара и материалов.
- Атомарность операций. Операции увеличения/уменьшения количества должны быть атомарными.
- Консистентность. Необходимо обеспечивать консистентность данных о запасах.

Альтернативные варианты: NoSQL база данных (Redis). Для хранения оперативной информации о текущем количестве товара для быстрого доступа.

**Сервис "Каталог товаров"**

Хранение и предоставление информации о товарах (название, описание, характеристики, цена, материалы, размеры, изображения, категории, производитель). Обеспечение поиска и фильтрации.

**Тип базы данных:** Реляционная база данных (например, PostgreSQL, MySQL).

**Обоснование:**
- Структурированные данные. Каталог продукции состоит из структурированных данных с четко определенными атрибутами.
- Сложные запросы. Требуется поддержка сложных запросов для поиска, фильтрации и сортировки.
- Транзакционная целостность. Важна транзакционная целостность данных, особенно при изменении цен, наличия товара и других атрибутов.
- Отношения: Необходимы отношения между товарами, категориями, производителями, материалами.

Альтернативные варианты: Документоориентированная база данных (MongoDB): Важна при гибкости структуры данных, например, для хранения дополнительных, часто меняющихся атрибутов.  Но это усложнит сложные запросы и поддержку целостности.

Гибридный подход: Использовать реляционную БД для основных атрибутов и документоориентированную БД для дополнительных.

**Сервис "Заказы"**

Хранение информации о заказах (состав заказа, статус, адрес доставки, платежная информация, история изменений, данные о производстве). Обработка заказов, управление статусами, интеграция с производством.

**Тип базы данных:** Реляционная база данных (например, PostgreSQL, MySQL).

**Обоснование:**
- Транзакционная целостность критически важна при обработке платежей и изменении статуса заказа.
- Отношения: Связи между заказами, пользователями, товарами, платежами, доставкой, данными о производстве.
- Сложные запросы: Требуются для получения информации о заказах по различным критериям.
- ACID-транзакции: Необходимы для гарантии консистентности.

Альтернативные варианты: Документоориентированная база данных (MongoDB). Например, для хранения истории изменений заказа.

**Сервис "Платежи"**

Обработка платежей, интеграция с платежными шлюзами, хранение истории платежей.

**Тип базы данных:** Реляционная база данных (RDBMS) (например, PostgreSQL, MySQL).

**Обоснование:**
- Транзакционная целостность: Критически важна при обработке платежей.
- Безопасность: Важна безопасность данных платежной информации.
- Аудит: Необходим аудит всех операций, связанных с платежами.

Альтернативные варианты:Использование платежных шлюзов. Можно не хранить платежную информацию в собственной базе данных, а использовать API платежных шлюзов.

**Сервис "Управление логистикой"**

Управление доставкой товаров, отслеживание местоположения, планирование маршрутов, интеграция с транспортными компаниями.

**Тип базы данных:** Реляционная база данных (например, PostgreSQL, MySQL) совместно с геопространственной базой данных (PostGIS, MongoDB с GeoJSON).

**Обоснование:**
- Структурированные данные: Информация о доставках, маршрутах.
- Геопространственные данные: Необходимо хранить и обрабатывать географические координаты для отслеживания местоположения и планирования маршрутов.
- Отношения: Связи между заказами, доставками, складами, транспортными компаниями.

### Модели данных

#### Пользователи

**USER**
| Поле | Тип |
| --- | --- |
| user_id | uuid |
| first_name | varchar(50) |
| last_name | varchar(50) |
| middle_name | varchar(50) |
| email | varchar(100) |
| phone | varchar(20) |
| address_id | uuid, nullable |
| role | enum ('customer', ','manager', 'admin') |
| created_at | timestamp |
| updated_at | timestamp |

**ADDRESS**
| Поле | Тип |
| --- | --- |
| address_id | uuid |
| region | varchar(50) |
| city | varchar(50) |
| street | varchar(50) |
| district | varchar(50) |
| postcode | varchar(10) |
| created_at | timestamp |
| updated_at | timestamp |

**Ожидаемый прирост**

| Тип | назначение | Месяц | Квартал |
| --- | --- | --- | --- |
| user | Профиль пользователя | ~ 1000 записей * (1 KB/запись) + ~ 200 записей (изменения) * (0.5 KB/запись) = ~ 1100 KB = ~ 1.1 MB | ~ 3.3 MB |
| address | Адресные данные | ~ 800 записей * (0.5 KB/запись) = ~ 400 KB (предполагаем, что часть пользователей использует один и тот же адрес,либо не указывает адрес) | 1.2 MB |

#### Управление производством

**PRODUCTORDER (производственный заказ)**

| Поле | Тип |
| --- | --- |
| product_order_id | uuid |
| order_id | uuid |
| product_id | uuid |
| quantity | integer |
| start_date | timestamp |
| end_date | timestamp |
| status | enum ('created', ','progress', 'completed', 'canceled') |
| created_at | timestamp |
| updated_at | timestamp |

**MATEARIALREQ (потребность в материале)**

| Поле | Тип |
| --- | --- |
| material_req_id | uuid |
| product_order_id | uuid |
| material_id | uuid |
| quantity | decimal (10,2) |
| init | varchar(50) |
| created_at | timestamp |
| updated_at | timestamp |

**OPERATION (операция)**

| Поле | Тип |
| --- | --- |
| operation_id | uuid |
| product_order_id | uuid |
| stage | integer |
| description | text |
| machine_id | uuid |
| employee_id | uuid |
| duration | integer |
| status | enum ('created', ','progress', 'completed') |
| created_at | timestamp |
| updated_at | timestamp |

**MACHINE (Станки)**

| Поле | Тип |
| --- | --- |
| machine_id | uuid |
| name | varchar(100) |
| description | text |
| status | enum ('active', ','inactive', 'maintenance') |
| created_at | timestamp |
| updated_at | timestamp |

**Ожидаемый прирост**

| Тип | назначение | Месяц | Квартал |
| --- | --- | --- | --- |
| productorder | Производственный заказ | ~ 500 записей * (1 KB/запись) = ~ 500 KB | ~ 1.5 MB |
| materialreq | Требуемый материал | ~ 500 заказов * 5 материалов/заказ * (0.5 KB/запись) = ~ 1250 KB = ~ 1.25 MB | ~ 3.7 MB |
| operation | Производимые операции |~ 500 заказов * 3 операции/заказ * (0.5 KB/запись) = ~ 750 KB | 2.2 MB |
| machine | Инфо о станках | ~ 2 записи * (0.5 KB/запись) = ~ 1 KB | 3 KB |

#### Управление складом

**INVENTORYITEM**
| Поле | Тип |
| --- | --- |
| inventory_item_id | uuid |
| product_id | uuid |
| quantity  | integer |
| location  | varchar(100) |
| created_at | timestamp |
| updated_at | timestamp |

**INVENTORYTRANSACTION**
| Поле | Тип |
| --- | --- |
| inventory_transaction_id | uuid |
| inventory_item_id | uuid |
| transaction_type | enum('in', 'out', 'adjustment') |
| quantity  | integer |
| reason | text |
| created_at | timestamp |
| updated_at | timestamp |

**Ожидаемый прирост**

| Тип | назначение | Месяц | Квартал |
| --- | --- | --- | --- |
| inventoryitem | Запасы на складе  | 50 новых товаров * (0.5 KB/запись) = ~ 25 KB | ~ 75 KB |
| inventorytrancsaction | Транзакция по запасу | ~ 500 заказов * 2 транзакции/заказ * (0.5 KB/запись) + ~ 100 корректировок * (0.5 KB/запись) = ~ 550 KB | 1.6 MB |

#### Каталог товаров

**PRODUCT**

| Поле | Тип |
| --- | --- |
| product_id | uuid |
| name | varchar(50) |
| description | text |
| price | varchar(50) |
| category_id | uuid |
| brand_id | uuid |
| materials | jsonb |
| proportions | jsonb |
| images | jsonArray |
| status | enum ('active', ','inactive', 'discontinued') |
| created_at | timestamp |
| updated_at | timestamp |

**CATEGORY**

| Поле | Тип |
| --- | --- |
| category_id | uuid |
| name | varchar(50) |
| description | text |
| parent_category_id | uuid |
| created_at | timestamp |
| updated_at | timestamp |

**BRAND**

| Поле | Тип |
| --- | --- |
| brand_id | uuid |
| name | varchar(50) |
| description | text |
| logo_url | varchar |
| created_at | timestamp |
| updated_at | timestamp |

**MATERIAL**

| Поле | Тип |
| --- | --- |
| material_id | uuid |
| name | varchar(100) |
| description | text |
| properties | jsonb |
| created_at | timestamp |
| updated_at | timestamp |

**Ожидаемый прирост**

| Тип | назначение | Месяц | Квартал |
| --- | --- | --- | --- |
| product | Товар | ~ 50 записей (изменения + новые) * (1-2 KB/запись) = ~ 50-100 KB | ~ 150-300 KB |
| category | Категории товаров | ~ 10 записей * (0.5 KB/запись) = ~ 5 KB | ~ 15 KB |
| brand | Бренды товаров |~ 2 записи * (0.5 KB/запись) = ~ 1 KB | 3 KB |
| material | Материал изготовления товара | ~ 5 записей * (0.5 KB/запись) = ~ 2.5 KB | 7.5 KB |

#### Заказы

**ORDER**

| Поле | Тип |
| --- | --- |
| order_id | uuid |
| user_id | uuid |
| order_date | timestamp
| total_amount | decimal(10,2) | 
| shipping_address_id | uuid |
| billing_address_id | uuid |
| status | enum ('pending', 'processing', 'shipped', 'delivered', 'cancelled') |
| bpayment_method | enum ('credit_card', 'paypal', 'bank_transfer') |
| created_at | timestamp |
| updated_at | timestamp |

**ORDERITEM**

| Поле | Тип |
| --- | --- |
| order_item_id | uuid |
| order_id | uuid |
| product_id | uuid |
| quantity | integer |
| price  | decimal(10,2) |
| created_at | timestamp |
| updated_at | timestamp |

**SHIPPINGADDRESS**

| Поле | Тип |
| --- | --- |
| shipping_address_id | uuid |
| region | varchar(50) |
| city | varchar(50) |
| street | varchar(50) |
| district | varchar(50) |
| postcode | varchar(10) |
| created_at | timestamp |
| updated_at | timestamp |

**BILLINGADDRESS**

| Поле | Тип |
| --- | --- |
| billing_address_id | uuid |
| region | varchar(50) |
| city | varchar(50) |
| street | varchar(50) |
| district | varchar(50) |
| postcode | varchar(10) |
| created_at | timestamp |
| updated_at | timestamp |

**Ожидаемый прирост**

| Тип | назначение | Месяц | Квартал |
| --- | --- | --- | --- |
| order | Информация о заказе | ~ 500 записей * (1 KB/запись) = ~ 500 KB | ~ 1.5 MB |
| orderitem | Позиции в заказе | ~ 500 заказов * 3 товара/заказ * (0.5 KB/запись) = ~ 750 KB | ~ 2.2 MB |
| shippingaddress | Адреса доставки |~ 400 записей * (0.5 KB/запись) = ~ 200 KB (часть адресов совпадает с существующими) | 800 KB |
| billingaddress | Выставление счета | ~ 400 записей * (0.5 KB/запись) = ~ 200 KB (часть адресов совпадает с существующими) | 600 KB |

#### Платежи

**PAYMENT**

| Поле | Тип |
| --- | --- |
| payment_id | uuid |
| order_id | uuid |
| payment_date | timestamp |
| amount | decimal(10,2) |
| payment_method | enum ('credit_card', 'paypal', 'bank_transfer') |
| transaction_id | varchar(50) |
| status | enum ('pending', 'approved', 'declined', 'refunded') |
| created_at | timestamp |
| updated_at | timestamp |


**Ожидаемый прирост**

| Тип | назначение | Месяц | Квартал |
| --- | --- | --- | --- |
| payment | Информация о платеже | ~ 500 записей * (1 KB/запись) = ~ 500 KB | ~ 1.5 MB |

#### Управление логистикой

**DELIVERY**

| Поле | Тип |
| --- | --- |
| delivery_id | uuid |
| order_id | uuid |
| shipping_address_id | uuid |
| tracking_number | varchar(50) |
| carrier  | varchar(50) |
| status | enum ('pending', 'in_transit', 'delivered', 'failed') |
| expected_delivery_date | date |
| actual_delivery_date | date |
| created_at | timestamp |
| updated_at | timestamp |

**DELIVERYEVENT**

| Поле | Тип |
| --- | --- |
| delivery_event_id | uuid |
| delivery_id | uuid |
| event_time | timestamp |
| location  | GEOGRAPHYPOINT |
| description  | text |
| status | enum ('pending', 'approved', 'declined', 'refunded') |
| created_at | timestamp |
| updated_at | timestamp |


**Ожидаемый прирост**

| Тип | назначение | Месяц | Квартал |
| --- | --- | --- | --- |
| delivery | Информация о доставке | ~ 500 записей * (1 KB/запись) = ~ 500 KB | ~ 1.5 MB |
| deliveryevent | Информация о событии доставки |~ 500 доставок * 5 событий/доставка * (0.5 KB/запись) = ~ 1250 KB = ~ 1.25 MB | ~ 3.7 MB |